<!--
  @description       : 
  @author            : AtifAhmedShariff
  @group             : 
  @last modified on  : 06-25-2025
  @last modified by  : AtifAhmedShariff
-->
<template>
    <template if:true={showWelcome}>
        <c-r-assist-chat-bot-welcome onqueryclick={handleCommonQuery}></c-r-assist-chat-bot-welcome>
    </template>
    <template if:false={showWelcome}>
        <!-- <div style="padding: 10px;">
            <c-r-assist-user-cart></c-r-assist-user-cart>
        </div> -->
        <div class="chatSpace">
            <div class="chat-screen active">
                <div class="chat-date">{today}</div>
                <div class="chat-messages">
                    <template lwc:if={hasMessages}>
                        <template for:each={messages} for:item="message">
                            <div key={message.id}>
                                <div class="message user">
                                    <div class="message-content">
                                        <div class="message-bubble">{message.prompt}</div>
                                        <div class="message-time">{message.time}</div>
                                    </div>
                                    <div class="message-avatar">You</div>
                                </div>
                                <template if:true={message.isLastMessage}>
                                    <template if:true={isGenerating}>
                                        <div class="message bot typing-indicator">
                                            <div class="message-avatar">ðŸ¤–</div>
                                            <div class="message-content">
                                                <div class="message-bubble">
                                                    <div class="typing-dots">
                                                        <span></span>
                                                        <span></span>
                                                        <span></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <template if:false={isGenerating}>
                                        <div class="message bot">
                                            <div class="message-avatar">ðŸ¤–</div>
                                            <div class="message-content">
                                                <div class="message-bubble"> <c-r-assist-rich-text
                                                        get-text={message.reponseTextValue}></c-r-assist-rich-text>
                                                </div>
                                                <template lwc:if={message.isDataTable}>
                                                    <div class="myTable">
                                                        <c-r-assist-chat-bot-data-table
                                                            received-table-data={message.tableDataFromAPI}></c-r-assist-chat-bot-data-table>

                                                    </div>
                                                    <br />
                                                </template>

                                                <template lwc:if={message.isChart}>
                                                    <br />

                                                    <div class="myTable">
                                                        <template lwc:if={message.showChart}>
                                                             <c-r-assist-chart-generator
                                                                    api-data={message.chartData}></c-r-assist-chart-generator>
                                                        </template>
                                                    </div>
                                                </template>
                                                <template lwc:if={message.isDataObject}>
                                                    <div class="myTable">
                                                        <c-r-assist-periodic-data-table
                                                            received-raw-data={message.dataObject}></c-r-assist-periodic-data-table>
                                                    </div>
                                                </template>
                                                <template lwc:if={message.isSource}>
                                                    <c-r-assist-rich-text
                                                        get-text={message.sources}></c-r-assist-rich-text>
                                                </template>

                                                <div class="message-time">{message.time}</div>
                                                <div class="message-actions">
                                                    <button class="action-btn" onclick={likeMessage} title="Like">
                                                        <svg width="16" height="16" viewBox="0 0 24 24"
                                                            fill="currentColor">
                                                            <path
                                                                d="M23,10C23,8.89 22.1,8 21,8H14.68L15.64,3.43C15.66,3.33 15.67,3.22 15.67,3.11C15.67,2.7 15.5,2.32 15.23,2.05L14.17,1L7.59,7.58C7.22,7.95 7,8.45 7,9V19A2,2 0 0,0 9,21H18C18.83,21 19.54,20.5 19.84,19.78L22.86,12.73C22.95,12.5 23,12.26 23,12V10M1,21H5V9H1V21Z" />
                                                        </svg>
                                                    </button>
                                                    <button class="action-btn" onclick={dislikeMessage} title="Dislike">
                                                        <svg width="16" height="16" viewBox="0 0 24 24"
                                                            fill="currentColor">
                                                            <path
                                                                d="M19,15H23V3H19V15M15,3H6C5.17,3 4.46,3.5 4.16,4.22L1.14,11.27C1.05,11.5 1,11.74 1,12V14C1,15.11 1.89,16 3,16H9.31L8.36,20.57C8.34,20.67 8.33,20.78 8.33,20.89C8.33,21.3 8.5,21.68 8.77,21.95L9.83,23L16.41,16.42C16.78,16.05 17,15.55 17,15V5C17,3.89 16.1,3 15,3Z" />
                                                        </svg>
                                                    </button>
                                                    <button class="action-btn" onclick={copyMessage} title="Copy">
                                                        <svg width="16" height="16" viewBox="0 0 24 24"
                                                            fill="currentColor">
                                                            <path
                                                                d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V5A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" />
                                                        </svg>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </template>
                                <template if:false={message.isLastMessage}>
                                    <template if:true={message.statusIsComplete}>
                                        <div class="message bot">
                                            <div class="message-avatar">ðŸ¤–</div>
                                            <div class="message-content">
                                                <div class="message-bubble"> <c-r-assist-rich-text
                                                        get-text={message.reponseTextValue}></c-r-assist-rich-text>
                                                </div>
                                                <template lwc:if={message.isDataTable}>
                                                    <div class="myTable">
                                                        <c-r-assist-chat-bot-data-table
                                                            received-table-data={message.tableDataFromAPI}></c-r-assist-chat-bot-data-table>
                                                    </div>
                                                    <br />
                                                </template>

                                                <template lwc:if={message.isChart}>
                                                    <br />
                                                    <div class="myTable">
                                                     
                                                        <template lwc:if={message.showChart}>
                                                                <c-r-assist-chart-generator
                                                                    api-data={message.chartData}></c-r-assist-chart-generator>
                                                        </template>
                                                    </div>
                                                </template>
                                                <template lwc:if={message.isDataObject}>
                                                    <div class="myTable">
                                                        <c-r-assist-periodic-data-table
                                                            received-raw-data={message.dataObject}></c-r-assist-periodic-data-table>
                                                    </div>
                                                </template>
                                                <template lwc:if={message.isSource}>
                                                    <c-r-assist-rich-text
                                                        get-text={message.sources}></c-r-assist-rich-text>
                                                </template>
                                                <div class="message-time">{message.time}</div>
                                                <div class="message-actions">
                                                    <button class="action-btn" onclick={likeMessage} title="Like">
                                                        <svg width="16" height="16" viewBox="0 0 24 24"
                                                            fill="currentColor">
                                                            <path
                                                                d="M23,10C23,8.89 22.1,8 21,8H14.68L15.64,3.43C15.66,3.33 15.67,3.22 15.67,3.11C15.67,2.7 15.5,2.32 15.23,2.05L14.17,1L7.59,7.58C7.22,7.95 7,8.45 7,9V19A2,2 0 0,0 9,21H18C18.83,21 19.54,20.5 19.84,19.78L22.86,12.73C22.95,12.5 23,12.26 23,12V10M1,21H5V9H1V21Z" />
                                                        </svg>
                                                    </button>
                                                    <button class="action-btn" onclick={dislikeMessage} title="Dislike">
                                                        <svg width="16" height="16" viewBox="0 0 24 24"
                                                            fill="currentColor">
                                                            <path
                                                                d="M19,15H23V3H19V15M15,3H6C5.17,3 4.46,3.5 4.16,4.22L1.14,11.27C1.05,11.5 1,11.74 1,12V14C1,15.11 1.89,16 3,16H9.31L8.36,20.57C8.34,20.67 8.33,20.78 8.33,20.89C8.33,21.3 8.5,21.68 8.77,21.95L9.83,23L16.41,16.42C16.78,16.05 17,15.55 17,15V5C17,3.89 16.1,3 15,3Z" />
                                                        </svg>
                                                    </button>
                                                    
                                                    <!-- <div class="message-bubble">{msg.text}</div> -->
                                                    <button class="action-btn" onclick={copyMessage} title="Copy">
                                                        <svg width="16" height="16" viewBox="0 0 24 24"
                                                            fill="currentColor">
                                                            <path
                                                                d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V5A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" />
                                                        </svg>
                                                    </button>
                                                  
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </template>
                            </div>
                        </template>
                    </template>
                </div>
            </div>

        </div>
    </template>
    <div class="chat-input">
        <c-r-assist-chat-bot-input onusermessage={handleUserMessage}></c-r-assist-chat-bot-input>
    </div>
</template>